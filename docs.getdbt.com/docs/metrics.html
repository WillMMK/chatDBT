<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-docs/build/metrics">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Metrics | dbt Developer Hub</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.getdbt.com/img/avatar.png"><meta data-rh="true" name="twitter:image" content="https://docs.getdbt.com/img/avatar.png"><meta data-rh="true" property="og:url" content="https://docs.getdbt.com/docs/build/metrics"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Metrics | dbt Developer Hub"><meta data-rh="true" name="description" content="When you define metrics in dbt projects, you encode crucial business logic in tested, version-controlled code. The dbt metrics layer helps you standardize metrics within your organization."><meta data-rh="true" property="og:description" content="When you define metrics in dbt projects, you encode crucial business logic in tested, version-controlled code. The dbt metrics layer helps you standardize metrics within your organization."><meta data-rh="true" name="keywords" content="dbt metrics layer"><link data-rh="true" rel="canonical" href="metrics.html"><link data-rh="true" rel="alternate" href="metrics.html" hreflang="en"><link data-rh="true" rel="alternate" href="metrics.html" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://57ZWAOQC7F-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="https://docs.getdbt.com/blog/rss.xml" title="dbt Developer Hub RSS Feed">
<link rel="alternate" type="application/atom+xml" href="https://docs.getdbt.com/blog/atom.xml" title="dbt Developer Hub Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="dbt Developer Hub" href="https://docs.getdbt.com/opensearch.xml">






<link href='https://d33wubrfki0l68.cloudfront.net/bundles/86c2f19a2ae35828239a5a9362ae97a45a3e36b0.css' rel='stylesheet'/>



<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;500;600;700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="icon" href="https://docs.getdbt.com/img/favicon.png" type="image/png">
<link rel="icon" href="https://docs.getdbt.com/img/favicon.svg" type="image/svg+xml">
<script src="https://code.jquery.com/jquery-3.4.1.min.js" defer="defer"></script>
<script src="https://cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js" defer="defer"></script>
<script src='https://d33wubrfki0l68.cloudfront.net/bundles/d791b6693c16c1841df84779b9b34e5f51a8490a.js'></script>
<script src="https://kit.fontawesome.com/7110474d41.js"></script><link href='https://d33wubrfki0l68.cloudfront.net/css/3b1f6b4f93b09261fa00a0957b856c308256f0dc/assets/css/styles.da37ce3e.css' rel='stylesheet'/>
<link rel="preload" href="https://docs.getdbt.com/assets/js/runtime~main.2cb82f36.js" as="script">
<link rel="preload" href="https://docs.getdbt.com/assets/js/main.55105ca8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="metrics.html#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_s0pr" style="background-color:#047377;color:#fff" role="banner"><div class="announcementBarPlaceholder_qxfj"></div><a target="_blank" rel="noopener noreferrer" href="https://www.getdbt.com/resources/staging-april-2023/?utm_medium=internal&amp;utm_source=docs&amp;utm_campaign=q1-2024_staging_ex&amp;utm_content=staging____&amp;utm_term=knowledge-builder_all__" class="announcementBarLink_lVWg" style="background-color:#047377;color:#fff"><div class="content_knG7 announcementBarContent_dpRF">See what's new in dbt — join us at Staging on April 26!</div></a><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_iXyO"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand dbt__brand" href="https://docs.getdbt.com/"><div class="navbar__logo"><img src="https://d33wubrfki0l68.cloudfront.net/38a468b6bb7aeae799ea43bb9510af0753b90d91/42e9b/img/dbt-logo.svg" alt="dbt Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://d33wubrfki0l68.cloudfront.net/b8dc46ef553c76847d944665fe5cebdea2e86542/83803/img/dbt-logo-light.svg" alt="dbt Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="../index.html">Docs</a><a class="navbar__item navbar__link" href="https://docs.getdbt.com/reference/dbt_project.yml">Reference</a><div class="navbar__item dropdown dropdown--hoverable"><a href="metrics.html#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link nav-versioning">v </a><ul class="dropdown__menu"><li><a class="dropdown__link nav-versioning-dropdown__link">1.5<!-- --> (Beta)</a></li><li><a class="dropdown__link nav-versioning-dropdown__link">1.4</a></li><li><a class="dropdown__link nav-versioning-dropdown__link">1.3</a></li><li><a class="dropdown__link nav-versioning-dropdown__link">1.2</a></li><li><a class="dropdown__link nav-versioning-dropdown__link">1.1</a></li><li><a class="dropdown__link nav-versioning-dropdown__link">1.0</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="metrics.html#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://courses.getdbt.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Courses<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/guides/best-practices">Guides</a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/blog">Developer Blog</a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/glossary">Glossary</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="metrics.html#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="https://docs.getdbt.com/community/join">Join the Community</a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/community/contribute">Become a contributor</a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/community/forum">Community Forum</a></li><li><a class="dropdown__link" href="https://docs.getdbt.com/community/events">Events</a></li></ul></div><a href="https://www.getdbt.com/signup/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link nav-create-account button button--primary">Create a free account</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="https://docs.getdbt.com/"><img src="https://d33wubrfki0l68.cloudfront.net/38a468b6bb7aeae799ea43bb9510af0753b90d91/42e9b/img/dbt-logo.svg" alt="dbt Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://d33wubrfki0l68.cloudfront.net/b8dc46ef553c76847d944665fe5cebdea2e86542/83803/img/dbt-logo-light.svg" alt="dbt Logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../index.html">What is dbt?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../supported-data-platforms.html">Supported data platforms</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../cloud/about-cloud/dbt-cloud-features.html">About dbt Cloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../quickstarts/overview.html">Quickstarts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../about-setup.html">Set up dbt</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="projects.html">Build dbt projects</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="projects.html">About dbt projects</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="sources.html">Build your DAG</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="sources.html">Sources</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="models.html">Models</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="seeds.html">Seeds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="snapshots.html">Snapshots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="exposures.html">Exposures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="metrics.html">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="groups.html">Groups</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="tests.html">Enhance your models</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="jinja-macros.html">Enhance your code</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="custom-schemas.html">Organize your outputs</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../deploy/deployments.html">Deploy dbt jobs</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploy dbt jobs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../collaborate/environments/environments-in-dbt.html">Collaborate with others</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../use-dbt-semantic-layer/quickstart-semantic-layer.html">Use the dbt Semantic Layer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../dbt-cloud-apis/overview.html">dbt APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="../core-versions.html">Available dbt versions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../dbt-support.html">dbt support</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="../faqs.html">Frequently asked questions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Frequently asked questions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_RiV8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="https://docs.getdbt.com/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Build dbt projects</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Build your DAG</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Metrics</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_EDxc"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Metrics</h1></header><div style="margin-bottom:10px"><span>▶<span style="cursor:pointer;font-style:italic;margin-left:5px">Changelog</span></span></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="about-metrics">About Metrics<a href="metrics.html#about-metrics" class="hash-link" aria-label="Direct link to About Metrics" title="Direct link to About Metrics">​</a></h2><p>A metric is an aggregation over a <span>table</span> that supports zero or more dimensions. Some examples of metrics include:</p><ul><li>active users</li><li>monthly recurring revenue (mrr)</li></ul><p>In v1.0, dbt supports metric definitions as a new node type. Like <a href="exposures.html">exposures</a>, metrics appear as nodes in the directed acyclic graph (DAG) and can be expressed in YAML files. Defining metrics in dbt projects encodes crucial business logic in tested, version-controlled code. Further, you can expose these metrics definitions to downstream tooling, which drives consistency and precision in metric reporting.</p><p>Review the video below to learn more about metrics, why they&#x27;re important, and how to get started:</p><div style="margin:40px 10px"><div class="loomWrapper_TTvb"><iframe width="640" class="loomFrame_B61a" height="400" src="https://www.loom.com/embed/b120ca9d042d46abad1d873a676bf20a" frameborder="0" allowfullscreen="" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="benefits-of-defining-metrics">Benefits of defining metrics<a href="metrics.html#benefits-of-defining-metrics" class="hash-link" aria-label="Direct link to Benefits of defining metrics" title="Direct link to Benefits of defining metrics">​</a></h3><p><strong>Use metric specifications in downstream tools</strong><br>
<!-- -->dbt&#x27;s compilation context can access metrics via the <a href="https://docs.getdbt.com/reference/dbt-jinja-functions/graph"><code>graph.metrics</code> variable</a>. The <a href="https://docs.getdbt.com/reference/artifacts/manifest-json">manifest artifact</a> includes metrics for downstream metadata consumption.</p><p><strong>See and select dependencies</strong><br>
<!-- -->As with Exposures, you can see everything that rolls up into a metric (<code>dbt ls -s +metric:*</code>), and visualize them in <a href="../collaborate/documentation.html">dbt documentation</a>. For more information, see &quot;<a href="https://docs.getdbt.com/reference/node-selection/methods#the-metric-method">The <code>metric:</code> selection method</a>.&quot;</p><link href='https://d33wubrfki0l68.cloudfront.net/css/d108c8e0fb7b0e3f1145f4ca6dcc3ba0db7985ec/css/featherlight-styles.css' rel='stylesheet'/><span class="docImage_EYbW"><span><a href="metrics.html#" data-featherlight="/img/docs/building-a-dbt-project/dag-metrics.png"><img data-toggle="lightbox" alt="Metrics appear as pink nodes in the DAG (for now)" title="Metrics appear as pink nodes in the DAG (for now)" src="https://d33wubrfki0l68.cloudfront.net/ac6ff111d703737ead36809ceb200d0e0c5f0692/3e64e/img/docs/building-a-dbt-project/dag-metrics.png"></a></span><span class="title_aGrV">Metrics appear as pink nodes in the DAG (for now)</span></span><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="defining-a-metric">Defining a metric<a href="metrics.html#defining-a-metric" class="hash-link" aria-label="Direct link to Defining a metric" title="Direct link to Defining a metric">​</a></h2><p>You can define metrics in <code>.yml</code> files nested under a <code>metrics:</code> key. Metric names must:</p><ul><li>contain only letters, numbers, and underscores (no spaces or special characters)</li><li>begin with a letter</li><li>contain no more than 250 characters</li></ul><p>For a short human-friendly name with title casing, spaces, and special characters, use the <code>label</code> property. More examples and guidance for how to <a href="https://docs.getdbt.com/blog/how-to-design-and-structure-metrics" target="_blank" rel="noopener noreferrer">define and structure metrics can be found here.</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-definition">Example definition<a href="metrics.html#example-definition" class="hash-link" aria-label="Direct link to Example definition" title="Direct link to Example definition">​</a></h3><div class="wrapper_V0Zw"><div class="title_BmGx"><div class="titleInner_QNi1"><svg class="icon_E6qs" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.5 5L10 7.5 7.5 10l-.75-.75L8.5 7.5 6.75 5.75 7.5 5zm-3 0L2 7.5 4.5 10l.75-.75L3.5 7.5l1.75-1.75L4.5 5zM0 13V2c0-.55.45-1 1-1h10c.55 0 1 .45 1 1v11c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1zm1 0h10V2H1v11z"></path></svg><span>models/&lt;filename&gt;.yml</span></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><ul><li>You cannot define metrics on <a href="materializations.html#ephemeral" target="_blank" rel="noopener noreferrer">ephemeral models</a>. To define a metric, the materialization must have a representation in the data warehouse.</li></ul></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="available-properties">Available properties<a href="metrics.html#available-properties" class="hash-link" aria-label="Direct link to Available properties" title="Direct link to Available properties">​</a></h3><p>Metrics can have many declared <strong>properties</strong>, which define aspects of your metric. More information on <a href="https://docs.getdbt.com/reference/configs-and-properties" target="_blank" rel="noopener noreferrer">properties and configs can be found here</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="available-calculation-methods">Available calculation methods<a href="metrics.html#available-calculation-methods" class="hash-link" aria-label="Direct link to Available calculation methods" title="Direct link to Available calculation methods">​</a></h3><table><thead><tr><th>  </th><th>Description</th></tr></thead><tbody><tr><td>count</td><td>This metric type will apply the <code>count</code> aggregation to the specified field</td></tr><tr><td>count_distinct</td><td>This metric type will apply the <code>count</code> aggregation to the specified field, with an additional distinct statement inside the aggregation</td></tr><tr><td>sum</td><td>This metric type will apply the <code>sum</code> aggregation to the specified field</td></tr><tr><td>average</td><td>This metric type will apply the <code>average</code> aggregation to the specified field</td></tr><tr><td>min</td><td>This metric type will apply the <code>min</code> aggregation to the specified field</td></tr><tr><td>max</td><td>This metric type will apply the <code>max</code> aggregation to the specified field</td></tr><tr><td>median</td><td>This metric type will apply the <code>median</code> aggregation to the specified field, or an alternative <code>percentile_cont</code> aggregation if <code>median</code> is not available</td></tr><tr><td> </td><td></td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="filters">Filters<a href="metrics.html#filters" class="hash-link" aria-label="Direct link to Filters" title="Direct link to Filters">​</a></h3><p>Filters should be defined as a list of dictionaries that define predicates for the metric. Filters are combined using AND clauses. For more control, users can (and should) include the complex logic in the model powering the metric. </p><p>All three properties (<code>field</code>, <code>operator</code>, <code>value</code>) are required for each defined filter.</p><p>Note that <code>value</code> must be defined as a string in YAML, because it will be compiled into queries as part of a string. If your filter&#x27;s value needs to be surrounded by quotes inside the query (e.g. text or dates), use <code>&quot;&#x27;nested&#x27;&quot;</code> quotes:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule" style="color:rgb(255, 203, 139)">filters</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:rgb(255, 203, 139)">field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> is_paying</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;is&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:rgb(255, 203, 139)">field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> lifetime_value</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;&gt;=&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;100&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:rgb(255, 203, 139)">field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> company_name</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;!=&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&#x27;Acme, Inc&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:rgb(255, 203, 139)">field</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> signup_date</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;&gt;=&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token key atrule" style="color:rgb(255, 203, 139)">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;&#x27;2020-01-01&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="calendar">Calendar<a href="metrics.html#calendar" class="hash-link" aria-label="Direct link to Calendar" title="Direct link to Calendar">​</a></h3><p>The dbt_metrics package contains a <a href="https://github.com/dbt-labs/dbt_metrics/blob/main/models/dbt_metrics_default_calendar.sql" target="_blank" rel="noopener noreferrer">basic calendar table</a> that is created as part of your <code>dbt run</code>. It contains dates between 2010-01-01 and 2029-12-31. </p><p>If you want to use a custom calendar, you can replace the default with any table which meets the following requirements:</p><ul><li>Contains a <code>date_day</code> column. </li><li>Contains the following columns: <code>date_week</code>, <code>date_month</code>, <code>date_quarter</code>, <code>date_year</code>, or equivalents. </li><li>Additional date columns need to be prefixed with <code>date_</code>, e.g. <code>date_4_5_4_month</code> for a 4-5-4 retail calendar date set. Dimensions can have any name (see following section).</li></ul><p>To do this, set the value of the <code>dbt_metrics_calendar_model</code> variable in your <code>dbt_project.yml</code> file: </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#dbt_project.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule" style="color:rgb(255, 203, 139)">config-version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">...</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule" style="color:rgb(255, 203, 139)">vars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token key atrule" style="color:rgb(255, 203, 139)">dbt_metrics_calendar_model</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> my_custom_calendar</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dimensions-from-calendar-tables">Dimensions from calendar tables<a href="metrics.html#dimensions-from-calendar-tables" class="hash-link" aria-label="Direct link to Dimensions from calendar tables" title="Direct link to Dimensions from calendar tables">​</a></h4><p>You may want to aggregate metrics by a dimension in your custom calendar table, for example is_weekend. You can include this within the list of dimensions in the macro call without it needing to be defined in the metric definition.</p><p>To do so, set a list variable at the project level called custom_calendar_dimension_list, as shown in the example below.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-yaml codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#dbt_project.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token key atrule" style="color:rgb(255, 203, 139)">vars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token key atrule" style="color:rgb(255, 203, 139)">custom_calendar_dimension_list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;is_weekend&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="querying-your-metric">Querying Your Metric<a href="metrics.html#querying-your-metric" class="hash-link" aria-label="Direct link to Querying Your Metric" title="Direct link to Querying Your Metric">​</a></h2><p>You can dynamically query metrics directly in dbt and verify them before running a job in the deployment environment.  To query your defined metric, you must have the <a href="https://github.com/dbt-labs/dbt_metrics" target="_blank" rel="noopener noreferrer">dbt_metrics package</a> installed. Information on how to <a href="packages.html#how-do-i-add-a-package-to-my-project" target="_blank" rel="noopener noreferrer">install packages can be found here</a>.</p><p>Use the following <a href="https://hub.getdbt.com/dbt-labs/metrics/latest/" target="_blank" rel="noopener noreferrer">metrics package</a> installation code in your packages.yml file and run <code>dbt deps</code> to install the metrics package:</p><p>Once the package has been installed with <code>dbt deps</code>, make sure to run the <code>dbt_metrics_default_calendar</code> model as this is required for macros used to query metrics. More information on this, and additional calendar functionality, can be found in the <a href="https://github.com/dbt-labs/dbt_metrics#calendar" target="_blank" rel="noopener noreferrer">project README</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="querying-metrics-with-metricscalculate">Querying metrics with <code>metrics.calculate</code><a href="metrics.html#querying-metrics-with-metricscalculate" class="hash-link" aria-label="Direct link to querying-metrics-with-metricscalculate" title="Direct link to querying-metrics-with-metricscalculate">​</a></h3><p>Use the <code>metrics.calculate</code> macro along with defined metrics to generate a SQL statement that runs the metric aggregation to return the correct metric dataset. Example below:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="supported-inputs">Supported inputs<a href="metrics.html#supported-inputs" class="hash-link" aria-label="Direct link to Supported inputs" title="Direct link to Supported inputs">​</a></h3><p>The example above doesn&#x27;t display all the potential inputs you can provide to the macro.</p><p>You may find some pieces of functionality, like secondary calculations, complicated to use. We recommend reviewing the <a href="https://github.com/dbt-labs/dbt_metrics" target="_blank" rel="noopener noreferrer">package README</a> for more in-depth information about each of the inputs that are not covered in the table below.</p><table><thead><tr><th>Input</th><th>Example</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td></td><td></td><td></td><td>Required</td></tr><tr><td>grain</td><td><code>&#x27;day&#x27;</code>, <code>&#x27;week&#x27;</code>, <br><code>&#x27;month&#x27;</code>, <code>&#x27;quarter&#x27;</code>, <br><code>&#x27;year&#x27;</code>, <code>&#x27;all_time&#x27;</code><br></td><td>The time grain that the metric will be aggregated to in the returned dataset</td><td>Required</td></tr><tr><td>dimensions</td><td>[<code>&#x27;plan&#x27;</code>,<br> <code>&#x27;country&#x27;</code>]</td><td>The dimensions you want the metric to be aggregated by in the returned dataset</td><td>Optional</td></tr><tr><td>secondary_calculations</td><td>[<code>metrics.period_over_period( comparison_strategy=&quot;ratio&quot;, interval=1, alias=&quot;pop_1wk&quot;)</code>]</td><td>Performs the specified secondary calculation on the metric results. Examples include period over period calculations, rolling calculations, and period to date calculations.</td><td>Optional</td></tr><tr><td>start_date</td><td><code>&#x27;2022-01-01&#x27;</code></td><td>Limits the date range of data used in the metric calculation by not querying data before this date</td><td>Optional</td></tr><tr><td>end_date</td><td><code>&#x27;2022-12-31&#x27;</code></td><td>Limits the date range of data used in the metric calculation by not querying data after this date</td><td>Optional</td></tr><tr><td>where</td><td><code>plan=&#x27;paying_customer&#x27;</code></td><td>A sql statement, or series of sql statements, that alter the <strong>final</strong> CTE in the generated sql. Most often used to limit the data to specific values of dimensions provided</td><td>Optional</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="secondary-calculations">Secondary Calculations<a href="metrics.html#secondary-calculations" class="hash-link" aria-label="Direct link to Secondary Calculations" title="Direct link to Secondary Calculations">​</a></h3><p>Secondary calculations are window functions you can add to the metric calculation and perform on the primary metric or metrics. </p><p>You can use them to compare values to an earlier period, calculate year-to-date sums, and return rolling averages. You can add custom secondary calculations into dbt projects - for more information on this, reference the <a href="https://github.com/dbt-labs/dbt_metrics#secondary-calculations" target="_blank" rel="noopener noreferrer">package README</a>.</p><p>The supported Secondary Calculations are:</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="period-over-period">Period over Period:<a href="metrics.html#period-over-period" class="hash-link" aria-label="Direct link to Period over Period:" title="Direct link to Period over Period:">​</a></h4><p>The period over period secondary calculation performs a calculation against the metric(s) in question by either determining the difference or the ratio between two points in time. The input variable, which looks at the grain selected in the macro, determines the other point. </p><table><thead><tr><th>Input</th><th>Example</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>comparison_strategy</code></td><td><code>ratio</code> or <code>difference</code></td><td>How to calculate the delta between the two periods</td><td>Yes</td></tr><tr><td><code>interval</code></td><td>1</td><td>Integer - the number of time grains to look back</td><td>Yes</td></tr><tr><td><code>alias</code></td><td><code>week_over_week</code></td><td>The column alias for the resulting calculation</td><td>No</td></tr><tr><td><code>metric_list</code></td><td><code>base_sum_metric</code></td><td>List of metrics that the secondary calculation should be applied to. Default is all metrics selected</td><td>No</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="period-to-date">Period to Date:<a href="metrics.html#period-to-date" class="hash-link" aria-label="Direct link to Period to Date:" title="Direct link to Period to Date:">​</a></h4><p>The period to date secondary calculation performs an aggregation on a defined period of time that is equal to or higher than the grain selected. For example, when you want to display a month_to_date value alongside your weekly grained metric.</p><table><thead><tr><th>Input</th><th>Example</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>aggregate</code></td><td><code>max</code>, <code>average</code></td><td>The aggregation to use in the window function. Options vary based on the primary aggregation and are enforced in <a href="https://github.com/dbt-labs/dbt_metrics/blob/main/macros/validation/validate_aggregate_coherence.sql" target="_blank" rel="noopener noreferrer">validate_aggregate_coherence()</a>.</td><td>Yes</td></tr><tr><td><code>period</code></td><td><code>&quot;day&quot;</code>, <code>&quot;week&quot;</code></td><td>The time grain to aggregate to. One of <!-- -->[<code>&quot;day&quot;</code>, <code>&quot;week&quot;</code>, <code>&quot;month&quot;</code>, <code>&quot;quarter&quot;</code>, <code>&quot;year&quot;</code>]<!-- -->. Must be at equal or coarser (higher, more aggregated) granularity than the metric&#x27;s grain (see <a href="metrics.html#time-grains">Time Grains</a> below). In example grain of <code>month</code>, the acceptable periods would be <code>month</code>, <code>quarter</code>, or <code>year</code>.</td><td>Yes</td></tr><tr><td><code>alias</code></td><td><code>month_to_date</code></td><td>The column alias for the resulting calculation</td><td>No</td></tr><tr><td><code>metric_list</code></td><td><code>base_sum_metric</code></td><td>List of metrics that the secondary calculation should be applied to. Default is all metrics selected</td><td>No</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rolling">Rolling:<a href="metrics.html#rolling" class="hash-link" aria-label="Direct link to Rolling:" title="Direct link to Rolling:">​</a></h4><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="developing-metrics-with-metricsdevelop">Developing metrics with <code>metrics.develop</code><a href="metrics.html#developing-metrics-with-metricsdevelop" class="hash-link" aria-label="Direct link to developing-metrics-with-metricsdevelop" title="Direct link to developing-metrics-with-metricsdevelop">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multiplederived-metrics-with-metricsdevelop">Multiple/Derived Metrics with <code>metrics.develop</code><a href="metrics.html#multiplederived-metrics-with-metricsdevelop" class="hash-link" aria-label="Direct link to multiplederived-metrics-with-metricsdevelop" title="Direct link to multiplederived-metrics-with-metricsdevelop">​</a></h4><p>If you have a more complicated use case that you are interested in testing, the develop macro also supports this behavior. The only caveat is that you must include the raw tags for any provided metric yml that contains a derived metric. Example below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#d6deeb;--prism-background-color:#011627"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-text codeBlock_qGQc thin-scrollbar"><code class="codeBlockLines_p187"><span class="token-line" style="color:#d6deeb"><span class="token plain">{% set my_metric_yml -%}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">{% raw %}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">metrics:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - name: develop_metric</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    model: ref(&#x27;fact_orders&#x27;)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    label: Total Discount ($)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    timestamp: order_date</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    time_grains: [day, week, month]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    calculation_method: average</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    expression: discount_total</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    dimensions:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - had_discount</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - order_country</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - name: derived_metric</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    label: Total Discount ($)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    timestamp: order_date</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    time_grains: [day, week, month]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    calculation_method: derived</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    expression: &quot;{{ metric(&#x27;develop_metric&#x27;) }} - 1 &quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    dimensions:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - had_discount</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - order_country</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">  - name: some_other_metric_not_using</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    label: Total Discount ($)</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    timestamp: order_date</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    time_grains: [day, week, month]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    calculation_method: derived</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    expression: &quot;{{ metric(&#x27;derived_metric&#x27;) }} - 1 &quot;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    dimensions:</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - had_discount</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">      - order_country</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">{% endraw %}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">{%- endset %}</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">select * </span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">from {{ metrics.develop(</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        develop_yml=my_metric_yml,</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        metric_list=[&#x27;derived_metric&#x27;]</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        grain=&#x27;month&#x27;</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#d6deeb"><span class="token plain">    }}</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above example will return a dataset that contains the metric provided in the metric list (<code>derived_metric</code>) and the parent metric (<code>develop_metric</code>). It will not contain <code>some_other_metric_not_using</code> as it is not designated in the metric list or a parent of the metrics included.</p><p><strong>Important caveat</strong> - You <em>must</em> wrap the <code>expression</code> property for <code>derived</code> metrics in double quotes to render it. For example,  <code>expression: &quot;{{ metric(&#x27;develop_metric&#x27;) }} - 1 &quot;</code>.</p><div class="snippet_iFq4"><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="questions-from-the-community">Questions from the Community<a href="metrics.html#questions-from-the-community" class="hash-link" aria-label="Direct link to Questions from the Community" title="Direct link to Questions from the Community">​</a></h3></div><div class="discourseTopics_Zzfb" style="min-height:auto"><img src="https://d33wubrfki0l68.cloudfront.net/5f75da46c691d1bb7e313d5d355267fa2c4fd076/4bf5d/img/loader-icon.svg" alt="Loading" class="loadingIcon_JyzA" data-testid="feed-loader"><a class="button button--primary discourseCta_pA_H" href="https://discourse.getdbt.com/new-topic?category=help&amp;tags=metrics" title="Ask the Community" target="_blank" rel="noopener noreferrer" data-testid="feed-cta">Ask the Community</a></div></div><div class="customSearchWeight_fp9e algolia-custom-search-weight">0</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dbt-labs/docs.getdbt.com/edit/current/website/docs/docs/build/metrics.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-03-16T16:28:31.000Z">Mar 16, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="exposures.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Exposures</div></a><a class="pagination-nav__link pagination-nav__link--next" href="groups.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Groups</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="metrics.html#about-metrics" class="table-of-contents__link toc-highlight">About Metrics</a><ul><li><a href="metrics.html#benefits-of-defining-metrics" class="table-of-contents__link toc-highlight">Benefits of defining metrics</a></li></ul></li><li><a href="metrics.html#defining-a-metric" class="table-of-contents__link toc-highlight">Defining a metric</a><ul><li><a href="metrics.html#example-definition" class="table-of-contents__link toc-highlight">Example definition</a></li><li><a href="metrics.html#available-properties" class="table-of-contents__link toc-highlight">Available properties</a></li><li><a href="metrics.html#available-calculation-methods" class="table-of-contents__link toc-highlight">Available calculation methods</a></li><li><a href="metrics.html#derived-metrics" class="table-of-contents__link toc-highlight">Derived Metrics</a></li><li><a href="metrics.html#expression-metrics" class="table-of-contents__link toc-highlight">Expression Metrics</a></li><li><a href="metrics.html#filters" class="table-of-contents__link toc-highlight">Filters</a></li><li><a href="metrics.html#calendar" class="table-of-contents__link toc-highlight">Calendar</a></li><li><a href="metrics.html#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li><li><a href="metrics.html#querying-your-metric" class="table-of-contents__link toc-highlight">Querying Your Metric</a><ul><li><a href="metrics.html#querying-metrics-with-metricscalculate" class="table-of-contents__link toc-highlight">Querying metrics with <code>metrics.calculate</code></a></li><li><a href="metrics.html#supported-inputs" class="table-of-contents__link toc-highlight">Supported inputs</a></li><li><a href="metrics.html#secondary-calculations" class="table-of-contents__link toc-highlight">Secondary Calculations</a></li><li><a href="metrics.html#developing-metrics-with-metricsdevelop" class="table-of-contents__link toc-highlight">Developing metrics with <code>metrics.develop</code></a></li></ul></li></ul><div class="col margin-top--sm"><a href="https://github.com/dbt-labs/docs.getdbt.com/edit/current/website/docs/docs/build/metrics.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item">
          <div class="footer__items">
            <a href="https://www.getdbt.com/cloud/terms/">Terms of Service</a>
            <a href="https://www.getdbt.com/cloud/privacy-policy/">Privacy Policy</a>
            <a href="https://www.getdbt.com/security/">Security</a>
            <button id="ot-sdk-btn" onclick="openPreferenceCenter()">Cookie Settings</button>
          </div>

          <div class="footer__items--right">
            <a href="https://twitter.com/getdbt"><i class="fa-brands fa-twitter"></i></a>
            <a href="https://www.getdbt.com/community/join-the-community/"><i class="fa-brands fa-slack"></i></a>
            <a href="https://github.com/dbt-labs/dbt-core"><i class="fa-brands fa-github"></i></a>
          </div>
          </span></div></div><div class="footer__bottom text--center"><div class="footer__copyright">&copy; 2023 dbt Labs, Inc. All Rights Reserved.</div></div></div></footer></div>
<script src='https://d33wubrfki0l68.cloudfront.net/bundles/901511404cae247883dcd0602b3685c939fa20be.js'></script>
</body>
</html>